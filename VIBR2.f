C ======================================================================
C       COMPUTERIZED PROCESSING AND GRAPHIC REPRESENTATION
C             OF VISCOELASTIC MATERIAL PROPERTY DATA
C ======================================================================
C
C This code was originally written in Fortran IV for the HP-2100
C minicomputer. The plotting routines made use of a Tektronix
C graphics screen terminal, access through a plotting package.
C As the Tektronix terminal is unavailable, the relevant
C subroutines have been replaced by suitable stubs, and some of the
C code commented out, in order to allow the porgram to be compiled
C successfully.
C
C Hence, this code is kept for archival purposes only. It can be used,
C if desired, to form the basis of a plotting-free version of the
C code.
C
C REFERENCE
C
C King, Karl S. Jr. Computerized processing and graphic 
C representation of viscoelastic material property data.
C AFML-TR-79-4099. Air Force Materials Laboratory, Air 
C Force Wright Aeronautical Laboratories, August 1979.

      PROGRAM VIBR2

      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
C
C    VIBR3 = #MATERIALS    (BLOCKS)
C    VIBR4 = 5*VIBR3
C    VIBR5 = VIBR3
C
      IY=1HY
      IR=5
      IW=6
      CALL INITT(1200)
      CALL TERM(2,1024)
 50   CALL ERAS
      CALL HOME
      CALL CHSIZ(3)
      CALL ANMOD
      CALL REDIN
      WRITE(IW,1000)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) CALL EDIT0
 100  CALL FITT0
      CALL PLTT0
      WRITE(IW,1000)
      READ(IR,1005) IYN
      IF(IYN.NE.IY) GO TO 300
      CALL EDIT0
      GO TO 100
 300  PAUSE
      WRITE(IW,1500)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) GO TO 450
 400  CALL MODUS
      CALL ETA
      WRITE(IW,4000)
      READ(IR,*) DELT0
      CALL GAXES(DELT0)
      CALL PLTPK(3)
      WRITE(IW,1500)
      READ(IR,1005) IYN
      IF(IYN.NE.IY) GO TO 500
 450  WRITE(IW,1600)
      READ(IR,*) TEMP0
      GO TO 400
 500  WRITE(IW,3000)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) CALL STORE
      WRITE(IW,2000)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) GO TO 50
      CALL FINIT(0,100)
1000  FORMAT(2X,19HEDIT THE DATA?(Y,N))
1005  FORMAT(1A1)

C  PAGE 78

1500  FORMAT(2X,41HCHANGE TO VALUE OR PARAMETER VALUES?(Y,N))
1600  FORMAT(2X,14HENTER TO VALUE)
2000  FORMAT(2X,27HBEGIN ANOTHER PROBLEM?(Y,N))
3000  FORMAT(2X,20HSTORE THE DATA?(Y,N))
4000  FORMAT(2X,21HENTER THE INTERVAL OF
     &       /2X,17HTEMPERATURE LINES)
      END

C=======================================================================

      SUBROUTINE REDIN()
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION BUF(320),NAME(3)
      IY=1HY
      WRITE(IW,5000)
      READ(IR,1005) IYN
      IF(IYN.NE.IY) GO TO 90
      WRITE(IW,6000)
      READ(IR,*) NMAX
      ICR=14
      LIBUF=128
      ICON=I3B
      NAME(1)=2HVI
      NAME(2)=2HBR
      NAME(3)=2H3 
      DO 80 I=1,NMAX
      INS=I-1
      CALL EXEC(ICR,ICON,IBUF,LIBUF,NAME,INS)
      IF(IBUF(121).NE.I) GO TO 80
      WRITE(IW,3200) IBUF(121),(IBUF(J),J=1,120)
   80 CONTINUE
   90 WRITE(IW,1000)
      READ(IR,1005) IYN
      IF(IYN.NE.IY) GO TO 200
      WRITE(IW,2000)
      WRITE(IW,2100)
      READ(IR,*) MATL
      IBUF(121)=MATL
      WRITE(IW,2200)
      READ(IR,1010) (IBUF(I),I=1,30)
      WRITE(IW,2300)
      READ(IR,1010) (IBUF(I),I=31,60)
      WRITE(IW,2400)
      READ(IR,1010) (IBUF(I),I=61,90)
      WRITE(IW,2500)
      READ(IR,1010) (IBUF(I),I=91,120)
      WRITE(IW,2600)
      READ(IR,*) NPTS
      IBUF(122)=NPTS
      METRC=0
      WRITE(IW,2650)

C  PAGE 79

      READ(IR,1005) IYN
      METRC=1
      IBUF(124)=1
      WRITE(IW,2675)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) IBUF(124)=0
      WRITE(IW,2700)
      WRITE(IW,2800)
      IF(METRC.EQ.1) WRITE(IW,2850)
      IF(METRC.EQ.0) WRITE(IW,2900)
      DO 100 I=1,NPTS
  100 READ(IR,*) N,(XIN(I,J),J=1,5)
      IF(METRC.EQ.1) GO TO 500
      DO 150 I=1,NPTS
      XIN(I,1)=XIN(I,1)*6894.757
  150 XIN(I,3)=5.0*(XIN(I,3)-32.0)/9.0
      GO TO 500
  200 WRITE(IW,3000)
      READ(IR,*) MATL
      ICR=14
      LBUF=640
      LIBUF=128
      ICON=I3B
      INS=MATL-1
      IRS=5*INS
      NAME(1)=2HVI
      NAME(2)=2HBR
      NAME(3)=2H3 
      CALL EXEC(ICR,ICON,IBUF,LIBUF,NAME,INS)
      IF(IBUF(121).EQ.MATL) GO TO 250
      WRITE(IW,3100)
      GO TO 200
  250 NAME(3)=2H4 
      NPTS=IBUF(122)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL EXEC(ICR,ICON,BUF,LBUF,NAME,IRS)
      DO 300 I=1,NPTS
      DO 300 J=1,5
  300 XIN(I,J)=BUF(5*(I-1)+J)
  500 CALL ERAS
      CALL HOME
      CALL ANMOD
      WRITE(IW,3200) IBUF(121),(IBUF(J),J=1,120)
      WRITE(IW,2800)
      WRITE(IW,2850)
      DO 600 I=1,NPTS
  600 WRITE(IW,3400) I,(XIN(I,J),J=1,5)
      PAUSE
      RETURN
 1000 FORMAT(2X,22HREAD IN NEW DATA?(Y,N))
 1005 FORMAT(1A1)
 1010 FORMAT(30A2)
 2000 FORMAT(2X,17HENTER HEADER DATA)
 2100 FORMAT(2X,30HENTER THE CODE OF THE MATERIAL)
 2200 FORMAT(2X,37HENTER THE MATERIAL NAME (MAX 60 CHAR.)
 2300 FORMAT(2X,48HENTER THE MANUFACTURER DATA SOURCE (MAX 60 CHAR.)

C  PAGE 80

 2400 FORMAT(2X,40HENTER THE AFML DATA SOURCE(MAX 60 CHAR.))
 2500 FORMAT(2X,38HENTER OTHER DATA SOURCES(MAX 60 CHAR.))
 2600 FORMAT(2X,44HENTER THE NUMBER OF DATA POINTS(MAX 64 PTS.))
 2650 FORMAT(2X,38HIS THE DATA TO BE ENTERED METRIC?(Y,N))
 2675 FORMAT(2X,31HIS THE MODULUS DATA SHEAR?(Y,N))
 2700 FORMAT(2X,32HREADY TO ENTER DATA FOR MATERIAL)
 2800 FORMAT(2X,3HNO.,3X,7HMODULUS,5X,4HLOSS,5X,5HTEMP.,4X,5HFREQ.,
     &       3X,4HMODE)
 2850 FORMAT(9X,6HN/M**2,4X,6HFACTOR,3X,6HDEG. C,5X,
     &       2HHZ,5X,3HNO.)
 2900 FORMAT(7X,8HLB/IN**2,4X,6HFACTOR,3X,6HDEG. F,5X,
     &       2HHZ,5X,3HNO.)
 3000 FORMAT(2X,36HENTER THE CODE OF RETRIEVAL MATERIAL)
 3100 FORMAT(2X,36HMISMATCH IN RETRIEVED MATERIAL CODES)
 3200 FORMAT(2X,15HMATERIAL CODE :,I3,
     &       /2X,10HMATERIAL .,30A2,/12X,12HDATA SOURCES,
     &       /2X,14HMANUFACTURER :,30A2,/2X,6HAFML :,30A2,
     &       /2X,7HOTHER :,30A2/)
 3400 FORMAT(2X,I3,1PE13.5,0PF9.4,F9.1,F9.1,F5.0)
 5000 FORMAT(2X,27HLIST THE STORED DATA? (Y,N))
 6000 FORMAT(2X,42HENTER THE MAXIMUM NUMBER OF MATERIAL CODES)
      END

C=======================================================================

      SUBROUTINE FITT0
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION X(64),COF(3)
      DO 100 I=1,NPTS
      X(I)=XIN(I,3)
      ETA=XIN(I,2)
  100 YD(I)=ALOG1(ETA)
      CALL POLYF(X,COF)
      DO 200 I=1,3
  200 COFT0(I)=COF(I)
      T0=-COF(2)/(2.0*COF(3))
      ITO=T0/10.0+0.5*ABS(TO)/10.0
      TEMP0=ITO*10.0
      RETURN
      END

C=======================================================================

      SUBROUTINE POLYF(X,COF)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION X(64),COF(3),A(3,3),B(3,3),C(3)
      DO 100 I=1,3

C  PAGE 81

      C(I)=0.0
      DO 100 J=1,3
  100 A(I,J)=0.0
      A(1,1)=NPTS
      DO 200 I=1,NPTS
      A(1,2)=A(1,2)+X(I)
      A(1,3)=A(1,3)+X(I)**2
      A(2,3)=A(2,3)+X(I)**3
      A(3,3)=A(3,3)+X(I)**4
      C(1)=C(1)+YD(I)
      C(2)=C(2)+X(I)*YD(I)
  200 C(3)=C(3)+YD(I)*X(I)**2
      A(2,1)=A(1,2)
      A(2,2)=A(1,3)
      A(3,1)=A(1,3)
      A(3,2)=A(2,3)
      B(1,1)=A(2,2)*A(3,3)-A(3,2)*A(2,3)
      B(2,1)=A(3,1)*A(2,3)-A(2,1)*A(3,3)
      B(3,1)=A(2,1)*A(3,2)-A(3,1)*A(2,2)
      B(1,2)=A(3,2)*A(1,3)-A(1,2)*A(3,3)
      B(2,2)=A(1,1)*A(3,3)-A(3,1)*A(1,3)
      B(3,2)=A(1,2)*A(3,1)-A(1,1)*A(3,2)
      B(1,3)=A(1,2)*A(2,3)-A(2,2)*A(1,3)
      B(2,3)=A(2,1)*A(1,3)-A(1,1)*A(2,3)
      B(3,3)=A(1,1)*A(2,2)-A(1,2)*A(2,1)
      DET=A(1,1)*B(1,1)+A(1,2)*B(2,1)+A(1,3)*B(3,1)
      DO 300 I=1,3
      DO 300 J=1,3
  300 A(I,J)=B(I,J)/DET
      DO 400 I=1,3
      COF(I) =0.0
      DO 400 J=1,3
  400 COF(I)=A(I,J)*C(J)+COF(I)
      RETURN
      END

C=======================================================================

      SUBROUTINE PLTT0
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      CALL ERAS
      ETMAX=XIN(1,2)
      ETMIN=XIN(1,2)
      TMAX=XIN(1,3)
      TMIN=XIN(1,3)
      FMAX=XIN(1,4)
      FMIN=XIN(1,4)
      DO 10 I=1,NPTS
      IF(XIN(I,2).GT.ETMAX) ETMAX=XIN(I,2)
      IF(XIN(I,2).LT.ETMIN) ETMIN=XIN(I,2)
      IF(XIN(I,3).GT.TMAX)  TMAX=XIN(I,3)

C  PAGE 82

      IF(XIN(I,3).LT.TMIN) TMIN=XIN(I,3)
      IF(XIN(I,4).GT.FMAX) FMAX=XIN(I,4)
      IF(XIN(I,4).LT.FMIN) FMIN=XIN(I,4)
10    CONTINUE
      IEXPN=ALOG1(ETMIN)
      ETMIN=IEXPN-1
      IEXPN=ALOG1(ETMAX)
      ETMAX=IEXPN+1
      IMULT=TMIN/10.0
      TMIN=10.0*(IMULT-1)
      IMULT=TMAX/10.0
      TMAX=10.0*(IMULT+1)
      IEXPN=ALOG1(FMIN)
      FMIN=IEXPN-1
      IEXPN=ALOG1(FMAX)
      FMAX=IEXPN+1
      CALL PLTT1(4,TMIN,TMAX,FMIN,FMAX)
      CALL PLTT1(2,TMIN,TMAX,ETMIN,ETMAX)
      CALL RESET
      CALL HOME
      CALL CHSIZ(3)
      CALL ANMOD
      WRITE(IW,3000) IBUF(121),(IBUF(J),J=1,30)
      WRITE(IW,2800)
      WRITE(IW,2850)
      DO 300 I=1,NPTS
  300 WRITE(IW,4000) I,(XIN(I,J),J=1,5)
      RETURN
 3000 FORMAT(2X,15HMATERIAL CODE :,I3,/2X,10HMATERIAL :,30A2)
 2800 FORMAT(2X,3HNO.,3X,7HMGDULUS,5X,4HLOSS,5X,5HTEMP.,4X,5HFREQ.,
     &       3X,4HMODE)
 2850 FORMAT(9X,6HN/M**2,4X,6HFACTOR,3X,6HDEG. C,5X,
     &       2HHZ,5X,3HNO.)
 4000 FORMAT(2X,I3,1PE13.5,0PF9.4,F9.1,F9.1,F5.0)
      END

C=======================================================================

      SUBROUTINE PLTT1(NUM,TMIN,TMAX,ETMIN,ETMAX)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION II(2),LABEL(9)
      ITEN=2H10
      CALL DWIND(TMIN,TMAX,ETMIN,ETMAX)
      IF(NUM.EQ.4) CALL TWIND(560,1010,420,770)
      IF(NUM.EQ.2) CALL TWIND(560,1010,30,380)
      CALL MOVEA(TMIN,ETMIN)
      CALL DRAWA(TMAX,ETMIN)
      CALL MOVEA(TMIN,ETMIN)
      CALL DRAWA(TMIN,ETMAX)
      TM=TMIN
  80  CALL MOVEA(TM,ETMIN)

C  PAGE 83

      CALL DREL(0,5)
      TM=TM+10.0
      IF(TM.LE.TMAX) GO TO 80
      ETM=ETMIN
  90  CALL MOVEA(TMIN,ETM)
      CALL DREL(5,0)
      ETM=ETM+1.0
      IF(ETM.LE.ETMAX) GO TO 90
      CALL CHSIZ(4)
      DO 100 I=1,NPTS
      TM=XIN(I,3)
      ETM=XIN(I,NUM)
      ETE=ALOG1(ETM)
      CALL PNTA(TM,ETE)
      CALL CODE
      WRITE(J,1000) I
      CALL MREL(2,-5)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL AOPST(2,J)
  100 CONTINUE
      IF(NUM.EQ.4) GO TO 115
      TM=TMIN
      ETM=(COFT0(1)+TM*(COFT0(2)+TM*COFT0(3)))
      CALL MOVEA(TM,ETM)
  110 TM=TM+0.5
      ETM=(COFT0(1)+TM*(COFT0(2)+TM*COFT0(3)))
      CALL DRAWA(TM,ETM)
      IF(TM.LT.TMAX) GO TO 110
  115 CALL CHSIZ(3)
      TM=TMIN
      MULT=(TMAX-TMIN)/100.0+1.0
  120 IT=TM
      CALL CODE
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>WRITE(II,2000) IT
      CALL MOVEA(TM,ETMIN)
      CALL MREL(-24,-14)
      CALL AOPST(4,II)
      TM=TM+MULT*10.0
      IF(TM.LE.TMAX) GO TO 120
      ETM=ETMIN
  130 IETME=ETM
      CALL CODE
      WRITE(J,1000) IETME
      CALL MOVEA(TMIN,ETM)
      CALL MREL(-36,-7)
      CALL CHSIZ(3)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL AOPST(2,ITEN)
      CALL MREL(1,7)
      CALL CHSIZ(4)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL AOPST(2,J)
      ETM=ETM+1.0
      IF(ETM.LE.ETMAX) GO TO 130
      CALL CHSIZ(3)
      IF(NUM.EQ.4) CALL MABS(754,390)
      IF(NUM.EQ.2) CALL MABS(754,0)
      LABEL(1)=2HTE

C  PAGE 84

      LABEL(2)=2HMP
      LABEL(3)=2HER
      LABEL(4)=2HAT
      LABEL(5)=2HUR
      LABEL(6)=2HE 
      LABEL(7)=2HDE
      LABEL(8)=2HG.
      LABEL(9)=2H C
      CALL AOPST(18,LABEL)
      IF(NUM.EQ.4) GO TO 140
      CALL MABS(570,360)
      LABEL(1)=2HET
      LABEL(2)=1HA
      CALL AOPST(3,LABEL)
      CALL MABS(900,360)
      LABEL(1)=2HTO
      LABEL(2)=2H =
      CALL AOPST(4,LABEL)
      IT=TEMP0
      CALL CODE
      WRITE(IW,2000) IT
      CALL AOPST(4,II)
      RETURN
  140 CALL MABS(570,750)
      LABEL(1)=2HFR
      LABEL(2)=2HEQ
      LABEL(3)=1H.
      CALL AOPST(5,LABEL)
      RETURN
 1000 FORMAT(I2)
 2000 FORMAT(I4)
      END

C=======================================================================

      SUBROUTINE EDIT0
      COMMON DUMMY(60),IR,XW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION IDE(64)
      ID=1HD
      IE=1HE
      IY=1HY
  10  WRITE(IW,1000)
      READ(IR,1005) IAD
      IF(IAD.EQ.ID) GO TO 100
      IF(IAD.EQ.IE) RETURN
      WRITE(IW,1100)
      READ(IR,*) NUM
      WRITE(IW,1150)
      READ(IR,1005) IYN
      METRC=0
      IF(IYN.EQ.IY) METRC=1

C  PAGE 85

      NL=NPTS+1
      NH=NPTS+NUM
      WRITE(IW,1200)
      DO 50 I=NL,NH
  50  READ(IR,*) N,(XIN(I,J),J=1,5)
      NPTS=NPTS+NUM
      IF(METRC.EQ.1) GO TO 10
      DO 60 I=NL,NH
      XIN(I,1)=XIN(I,1)*6894.757
  60  XIN(I,3)=5.0*(XIN(I,3)-32.0)/9.0
      GO TO 10
  100 WRITE(IW,2000)
      READ(IR,*) NUM,(IDE(I),I=1,NUM)
      DO 200 I=1,NUM
      II=IDE(I)
      DO 200 J=1,5
  200 XIN(II,J)=0.0
      J=0
      DO 300 I=1,NPTS
      IF(XIN(I,1).EQ.0.0) GO TO 300
      J=J+1
      DO 250 K=1,5
      XIN(J,K)=XIN(I,K)
  250 CONTINUE
  300 CONTINUE
      NPTS=NPTS-NUM
      GO TO 10
 1000 FORMAT(2X,48HEDIT THE ABOVE DATA: ADD, DELETE, OR END?(A,D,E))
 1005 FORMAT(1A1)
 1100 FORMAT(2X,38HENTER THE NUMBER OF DATA POINTS TO ADD)
 1200 FORMAT(2X,30HREADY TO ADD DATA FOR MATERIAL
     &     / 7X,21HIN FORMAT SHOWN ABOVE)
 2000 FORMAT(2X,31HENTER THE NUMBER OF DATA POINTS
     &     / 2X,32HT0 DELETE AND THE INDICES OF THE
     &     / 11X,14HROWS TO DELETE)
 1150 FORMAT(2X,36HIS THE DATA TO BE ADDED METRIC?(Y,N))
      END

C=======================================================================

       SUBROUTINE STORE
       COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &        COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &        MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
       DIMENSION BUF(320),NAME(3),BUFA(64)
       DO 100 I=1,NPTS
       DO 100 J=1,5
  100  BUF(5*(I-1)+J)=XIN(I,J)
       IBUF(122)=NPTS
       IBUF(125)=1
       BUFA(1)=TEMP0
       BUFA(2)=COFT0(1)
       BUFA(3)=COFT0(2)

C  PAGE 86

      BUFA(4)=COFT0(3)
      BUFA(5)=GPAR(1)
      BUFA(6)=GPAR(2)
      BUFA(7)=GPAR(3)
      BUFA(8)=GPAR(4)
      BUFA(9)=ETPAR(1)
      BUFA(10)=ETPAR(2)
      BUFA(11)=ETPAR(3)
      BUFA(12)=ETPAR(4)
      BUFA(13)=ETPAR(5)
      BUFA(14)=DELTA(1)
      BUFA(15)=DELTA(2)
      BUFA(16)=DELTA(3)
      BUFA(17)=DELTA(4)
      BUFA(18)=DELTA(5)
      ICR=15
      LBUF=640
      LIBUF=128
      ICON=I3B
      INS=IBUF(121)-1
      IRS=5*INS
      NAME(1)=2HVI
      NAME(2)=2HBR
      NAME(3)=2H3 
      CALL EXEC(ICR,ICON,IBUF,LIBUF,NAME,INS)
      NAME(3)=2H4 
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL EXEC(ICR,ICON,BUF,LBUF,NAME,IRS)
      NAME(3)=2H5 
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL EXEC(ICR,ICON,BUFA,LIBUF,NAME,INS)
      WRITE(IW,1000)
      PAUSE
      RETURN
 1000 FORMAT(2X,22HABOVE PLOTTED DATA AND
     &/2X,24HPARAMETERS ARE STORED ON
     &/2X,30HFILES: VIBR3, VIBR4, AND VIBR5)
      END

C=======================================================================

      SUBROUTINE MODUS
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION A(5),ICON(5),FR(64),COF(3)
      IY=1HY
      CALL ERAS
      CALL HOME
      CALL ANMOD
      WRITE(IW,1900)
      NFUN=1
      NPAR=4
      TEMP=XIN(1,3)
      FRMIN=ALPHT(TEMP)*XIN(1,4)

C  PAGE 87

      FRMAX=FRMIN
      GMIN=XIN(1,1)
      DO 20 I=1,NPTS
      TEMP=XIN(I,3)
      FRX=ALPHT(TEMP)*XIN(I,4)
      IF(FRX.LT.FRMIN) FRMIN=FRX
      IF(FRX.GT.FRMAX) FRMAX=FRX
      IF(XIN(I,1).LT.GMIN) GMIN=XIN(I,1)
      FR(I)=ALOG1(FRX)
      G=XIN(I,1)
      YD(I)=ALOG1(G)
  20  CONTINUE
      CALL POLYF(FR,COF)
      A(1)=SQRT(FRMIN*FRMAX)
      A1=ALOG1(A(1))
      A(2)=10.0**(COF(1)+A1*(COF(2)+A1*COF(3)))
      A(3)=0.4
      A(4)=0.5*GMIN
      DO 30 I=1,NPAR
      DELTA(I)=0.1*A(I)
      IF(DELTA(I).EQ.0.0) DELTA(I)=0.1
  30  DELMI(I)=0.01*DELTA(I)
      MASK(1)=1
      MASK(2)=1
      MASK(3)=0
      MASK(4)=1
      WRITE(IW,2000)
      READ(IR,*) CNSTR(1)
      WRITE(IW,2100)
      READ(IR,*) CNSTR(2)
      WRITE(IW,2200)
      READ(IR,*) CNSTR(3)
      WRITE(IW,2300)
      READ(IR,*) CNSTR(4)
      CALL SEARC(A,NFUN)
      DO 40 I=1,NPAR
  40  MASK(I)=0
  50  CALL SEARC(A,NFUN)
      DO 60 I=1,NPAR
  60  GPAR(I)=A(I)
      CALL PLTPK(NFUN)
      WRITE(IW,1000)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) RETURN
      DO 70 I=1,NPAR
  70  MASK(I)=0
      WRITE(IW,1100)
      READ(IR,1005) IYN
      IF(IYN.NE.IY) GO TO 300
      WRITE(IW,1200)
      READ(IR,*) NCON,(ICON(I),I=1,NCON)
      DO 100 I=1,NCON
  100 MASK(ICON(I))=1
  300 WRITE(IW,1300)
      READ(IR,*) A(1)

C  PAGE 88

      WRITE(IW,1400)
      READ(IR,*) A(2)
      WRITE(IW,1500)
      READ(IR,*) A(3)
      WRITE(IR,1600)
      READ(IR,*) A(4)
      GO TO 50
 1900 FORMAT(2X,16HFIT MODULUS DATA)
 2000 FORMAT(2X,41HENTER THE MINIMUM VALUE OF FROM PARAMETER)
 2100 FORMAT(2X,41HENTER THE MINIMUM VALUE OF MROM PARAMETER)
 2200 FORMAT(2X,41HENTER THE MAXIMUM VALUE OF MROM PARAMETER)
 2300 FORMAT(2X,39HENTER THE MINIMUM VALUE OF ML PARAMETER)
 1000 FORMAT(2X,25HACCEPT THESE VALUES?(Y,N))
 1005 FORMAT(1A1)
 1100 FORMAT(2X,34HHOLD ANY PARAMETERS CONSTANT?(Y,N))
 1200 FORMAT(2X,31HENTER THE NUMBER AND INDICES OF
     &     / 2X,23HTHE CONSTANT PARAMETERS)
 1300 FORMAT(2X,30HENTER FROM(A1) PARAMETER VALUE)
 1400 FORMAT(2X,30HENTER MROM(12) PARAMETER VALUE)
 1500 FORMAT(2X,27HENTER N(A3) PARAMETER VALUE)
 1600 FORMAT(2X,28HENTER ML(A4) PARAMETER VALUE)
      END

C=======================================================================

      SUBROUTINE ETA
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION B(5),ICON(5),FR(64),COF(3)
      IY=1HY
      CALL ERAS
      CALL HOME
      CALL ANMOD
      WRITE(IW,1900)
      NFUN=2
      NPAR=5
      DO 20 I=1,NPTS
      ETAX=XIN(I,2)
      YD(I)=ALOG1(ETAX)
      TEMP=XIN(I,3)
      FRX=ALPHT(TEMP)*XIN(I,4)
   20 FR(I)=ALOG1(FRX)
      CALL POLYF(FR,COF)
      B4=-COF(2)/(2.0*COF(3))
      B(1)=10.0**(COF(1)+B4*(COF(2)+B4*COF(3)))
      B(2)=0.35
      B(3)=-0.45
      B(4)=10.0**B4
      B(5)=4.0
      DO 30 I=1,NPAR
      DELTA(I)=0.1*B(I)
      IF (DELTA(1).EQ.0.0) DELTA(I)=0.1

C  PAGE 89

  30  DELMI(I)=0.01*DELTA(I)
      MASK(1)=1
      MASK(2)=1
      MASK(3)=1
      MASK(4)=1
      MASK(5)=0
      WRITE(IW,2000)
      READ(IR,*) CNSTR(1)
      WRITE(IW,2100)
      READ(IR,*) CNSTR(2)
      WRITE(IW,2200)
      READ(IR,*) CNSTR(3)
      WRITE(IW,2300)
      READ(IR,*) CNSTR(4)
      CALL SEARC(B,NFUN)
      DO 40 I=1,NPAR
  40  MASK(I)=0
  50  CALL SEARC(B,NFUN)
      DO 60 I=1,NPAR
  60  ETPAR(I)=B(I)
      CALL PLTPK(NFUN)
      WRITE(IW,1000)
      READ(IR,1005) IYN
      IF(IYN.EQ.IY) RETURN
      DO 70 I=1,NPAR
  70  MASK(I)=0
      WRITE(IW,1100)
      READ(IR,1005) IYN
      IF(IYN.NE.IY) GO TO 300
      WRITE(IW,1200)
      READ(IR,*) NCON,(ICON(I),I=1,NCON)
      DO 100 I=1,NCON
  100 MASK(ICON(I))=1
  300 WRITE(IW,1300)
      READ(IR,*) B(1)
      WRITE(IW,1400)
      READ(IR,*) B(2)
      WRITE(IW,1500)
      READ(IR,*) B(3)
      WRITE(IW,1600)
      READ(IR,*) B(4)
      WRITE(IW,1700)
      READ(IR,*) B(5)
      GO TO 50
 1900 FORMAT(2X,20HFIT LOSS FACTOR DATA)
 2000 FORMAT(2X,44HENTER THE MINIMUM VALUE OF ETAFROL PARAMETER)
 2100 FORMAT(2X,39HENTER THE MINIMUM VALUE OF SL PARAMETER)
 2200 FORMAT(2X,39HENTER THE MAXIMUM VALUE OF SH PARAMETER)
 2300 FORMAT(2X,41HENTER THE MINIMUM VALUE OF FROL PARAMETER)
 1000 FORMAT(2X,25HACCEPT THESE VALUES?(Y,N))
 1005 FORMAT(1A1)
 1100 FORMAT(2X,34HHOLD ANY PARAMETERS CONSTANT?(Y,N))
 1200 FORMAT(2X,31HENTER THE NUMBER AND INDICES OF
     &     / 2X,23HTHE CONSTANT PARAMETERS)
 1300 FORMAT(2X,33HENTER ETAFROL(B1) PARAMETER VALUE)

C  PAGE 90

 1400 FORMAT(2X,28HENTER SL(B2) PARAMETER VALUE)
 1500 FORMAT(2X,28HENTER SN(B3) PARAMETER VALUE)
 1600 FORMAT(2X,30HENTER FROL(B4) PARAMETER VALUE)
 1700 FORMAT(2X,27HENTER C(B5) PARAMETER VALUE)
      END

C=======================================================================

      SUBROUTINE FCN(X,NFUN)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION X(5)
      F=0.0
      DO 30 I=1,NPTS
      TEMP=XIN(I,3)
      FR=ALPHT(TEMP)*XIN(I,4)
      DF=YD(I)-FCT(FR,X,NFUN)
   30 F=F+DF*DF
      CHISQ=F
      RETURN
      END

C=======================================================================

      FUNCTION FCT(FR,X,NFUN)
      DIMENSION X(5)
      GO TO (10,20),NFUN
   10 FCT=F1(FR,X)
      RETURN
   20 FCT=F2(FR,X)
      RETURN
      END

C=======================================================================

      FUNCTION ALPHT(TEMP)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      ALPHT=10.0**(-12.0*(TEMP-TEMP0)/(525.0/1.8+TEMP-TEMP0))
      RETURN
      END
      
C  PAGE 91

C=======================================================================

      FUNCTION F1(FR,A)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION A(5)
      F1=0.0
      IF(NPAR.EQ.0) GO TO 100
      IF(A(1).LT.CNSTR(1)) F1=1.0E10
      IF(A(2).LT.CNSTR(2)) F1=1.0E10
      IF(A(2).GT.CNSTR(3)) F1=1.0E10
      IF(A(4).LT.CNSTR(4)) F1=1.0E10
      IF(F1.NE.0.0) RETURN
  100 D=1.0+(A(1)/FR)**A(3)
      G=ALOG1(A(4))
      F1=G+(2.0*ALOG1(A(2)/A(4)))/D
      RETURN
      END

C=======================================================================

      FUNCTION F2(FR,B)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION B(5)
      F2=0.0
      IF(NPAR.EQ.0) GO TO 100
      IF(B(1).LT.CNSTR(1)) F2=1.0E10
      IF(B(2).LT.CNSTR(2)) F2=1.0E10
      IF(B(3).GT.CNSTR(3)) F2=1.0E10
      IF(B(4).LT.CNSTR(4)) F2=1.0E10
      IF(F2.NE.0.0) RETURN
  100 A=ALOG1(FR/B(4))/B(5)
      C=ALOG1(B(1))
      D=1.0-SQRT(1.0+A*A)
      F2=C+((B(2)+B(3))*A+(B(2)-B(3))*D)*B(5)/2.0
      RETURN
      END

C=======================================================================

      FUNCTION ALOG1(X)
      CONST=ALOG(10.0)
      ALOG1=ALOG(X)/CONST
      RETURN
      END

C  PAGE 92

      SUBROUTINE VERTL(NUM,LABEL)
      DIMENSION LABEL(*)
      DO 100 I=1,NUM
      CALL AOPST(1,LABEL(I))
      CALL MREL(-13,-21)
  100 CONTINUE
      RETURN
      END

C=======================================================================

      SUBROUTINE SEARC(X,NFUN)
      COMMON DOMMY(60),IR,ILIBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NV,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION CHI(6),Z(6,5),ZBAR(5),ZSTAR(5),X(5)
      ALPHA=1.0
      BETA=0.5
      GAMMA=2.0
      HUGE=1.0E37
      SIGNI=1.0E5
      NVP=NV+1
      NF=0
    1 DO 10 J=1,NV
   10 Z(NV+1,J)=X(J)
      CALL FCN(X,NFUN)
      NF=NF+1
      CHI(NV+1)=CHISQ
      DO 30 J=1,NV
      DO 20 K=1,NV
   20 Z(J,K)=X(K)
      SIGN=1.0
   23 IF(MASK(J).EQ.1) GO TO 21
      Z(J,J)=Z(J,J)+SIGN*DELTA(J)
   21 XS=X(J)
      X(J)=Z(J,J)
      CALL FCN(X,NFUN)
      NF=NF+1
      X(J)=XS
      IF(CHI(NV+1)-CHISQ) 22,30,30
   22 IF(SIGN.EQ.-2.0) GO TO 30
      SIGN=-2.0
      GO TO 23
   30 CHI(J)=CHISQ
   40 JH=1
      JL=1
      DO 80 J=2,NVP
      IF(CHI(J)-CHI(JH)) 60,60,50
   50 JH=J
   60 IF(CHI(J)-CHI(JL)) 70,80,60
   70 JL=J
   80 CONTINUE
   90 DO 120 J=1,NV
      ZBAR(J)=0.0

C  PAGE 93

       DO 110 K=1,NVP
       IF(K-JH) 100,110,100
  100  ZBAR(J)=ZBAR(J)+Z(K,J)
  110  CONTINUE
  120  ZBAR(J)=ZBAR(J)/FLOAT(NV)
       DO 130 J=1,NV
        IF(MASK(J).EQ.1) GO TO 130
       X(J)=(1.0+ALPHA)*ZBAR(J)-ALPHA*Z(JH,J)
  130  ZSTAR(J)=X(J)
       CALL FCN(X,NFUN)
       NF=NF+1
       CHIST=CHISQ
       IF(CHISQ-CHI(JL)) 160,180,180
  160 DO 170 J=1,NV
      IF(MASK(J).EQ.1) GO TO 170
      X(J)=GAMMA*X(J)+(1.0-GAMMA)*ZBAR(J)
  170 CONTINUE
      CALL FCN (X,NFUN)
      NF=NF+1
      IF(CHISQ-CHIST) 420,230,230
  180 DO 200 J=1,NVP
      IF(J-JH) 190,200,190
  190 IF(CHISQ-CHI(J)) 230,200,200
  200 CONTINUE
      IF(CHISQ-CHI(JH)) 250,270,270
  230 DO 240 J=1,NV
  240 Z(JH,J)=ZSTAR(J)
      CHI(JH)=CHIST
      GO TO 440
  250 DO 260 J=1,NV
  260 Z(JH,J)=X(J)
      CHI(JH)=CHISQ
  270 DO 280 J=1,NV
      IF(MASK(J).EQ.1) GO TO 280
      X(J)=BETA*Z(JH,J)+(1.0-BETA)*ZBAR(J)
  280 CONTINUE
      CALL FCN(X,NFUN)
      NF=NF+1
      IF(CHISQ-CHI(JH)) 420,350,350
  350 JS=JL
      DO 390 J=1,NVP
      IF(J-JL) 360,390,360
  360 DO 370 K=1,NV
      Z(J,K)=0.5*(Z(J,K)+Z(JL,K))
  370 X(K)=Z(J,K)
      CALL FCN(X,NFUN)
      NF=NF+1
      IF(CHISQ-CHI(JL)) 380,391,391
  380 JS=J
  391 CHI(J)=CHISQ
  390 CONTINUE
      JL=JS
      GO TO 440
  420 DO 430 J=1,NV
  430 Z(JH,J)=X(J)

C  PAGE 94

      CHI(JH)=CHISQ
  440 DO 470 J=1,NV
      IF(MASK(J).EQ.1) GO TO 470
      ZMAX=-HUGE
      ZMIN=+HUGE
      DO 450 K=1,NVP
      ZMAX=AMAX1(ZMAX,Z(K,J))
  450 ZMIN=AMIN1(ZMIN,Z(K,J))
      IF(SIGNI*(ZMAX-ZMIN)-AMIN1(ABS(ZMAX),ABS(ZMIN))) 470,470,460
  460 IF(ZMAX-ZMIN-ABS(DELMI(J))) 470,470,475
  470 CONTINUE
      GO TO 480
  475 JH=1
      JL=1
      DO 479 J=2,NVP
      IF(CHI(J)-CHI(JH)) 477,477,476
  476 JH=J
  477 IF(CHI(J)-CHI(JL)) 478,479,479
  478 JL=J
  479 CONTINUE
      IF(SIGNI*(CHI(JH)-CHI(JL))-CHI(JL)) 480,480,90
  480 IF(CHI(JH)-CHI(JL)) 490,500,500
  490 JL=JH
  500 CHISQ=CHI(JL)
      DO 510 J=1,NV
  510 X(J)=Z(JL,J)
  999 RETURN
      END

      SUBROUTINE GAXES(DELT0)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELMI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      DIMENSION II(2),A(5),LABEL(15),ITEN(1)
      CALL ERAS
      ITEN(1)=2H10
      IP=1H+
      IX=1HX
      NPAR=0
      TEMP=XIN(1,3)
      FRMIN=ALPHT(TEMP)*XIN(1,4)
      FRMAX=FRMIN
      GMIN=XIN(1,1)
      GMAX=GMIN
      ETMIN=XIN(1,2)
      DO 50 I=1,NPTS
      IF(XIN(I,1).LT.GMIN) GMIN=XIN(I,1)
      IF(XIN(I,1).GT.GMAX) GMAX=XIN(I,1)
      IF(XIN(I,2).LT.ETMIN) ETMIN=XIN(I,2)
      TEMP=XIN(I,3)
      FR=ALPHT(TEMP)*XIN(I,4)
      IF(FR.LT.FRMIN) FRMIN=FR
      IF(FR.GT.FRMAX) FRMAX=FR
   50 CONTINUE
      IEFR=ALOG1(FRMIN)
      FRMIN=IEFR-2

C  PAGE 95

      IEFR=ALOG1(FRMAX)
      FRMAX=IEFR+2
      IGMIN=ALOG1(GMIN)
      IGMIN=IGMIN-1
      IGMAX=ALOG1(GMAX)
  60  IGMAX=IGMAX+1
      IDIFG=IGMAX-IGMIN
      IF(IDIFG.LT.4) GO TO 60
      GMIN=IGMIN
      GMAX=IGMAX
      IETMI=ALOG1(ETMIN)
      ETMIN=IETMI-1
      ETMAX=IETMI-1+IDIFG
      FMIN=0.0
      FMAX=IDIFG
      DELTA(1)=FRMIN
      DELTA(2)=FRMAX
      DELTA(3)=GMIN
      DELTA(4)=GMAX
      DELTA(5)=ETMIN
      INDEX=1
  70  CONTINUE
      IF(INDEX.EQ.1) CALL DWIND(FRMIN,FRMAX,GMIN,GMAX)
      IF(INDEX.EQ.2) CALL DWIND(FRMIN,FRMAX,ETMIN,ETMAX)
      CALL TWIND(140,960,50,730)
      IF(INDEX.EQ.2) GO TO 117
      FR=FRMIN
  100 DO 105 I=1,10
      XI=I
      XFR=FR+ALOG1(XI)
      CALL MOVEA(XFR,GMIN)
      CALL DRAWA(XFR,GMAX)
  105 CONTINUE
      FR=FR+1.0
      IF(FR.LT.FRMAX) GO TO 100
      G=GMIN
  110 DO 115 I=1,10
      XI=I
      XG=G+ALOG1(XI)
      CALL MOVEA(FRMIN,XG)
      CALL DRAWA(FRMAX,XG)
  115 CONTINUE
      G=G+1.0
      IF(G.LT.GMAX) GO TO 110
  117 CALL CHSIZ(3)
      DO 120 I=1,NPTS
      TEMP=XIN(I,3)
      FR=ALPHT(TEMP)*XIN(I,4)
      G=XIN(I,INDEX)
      EFR=ALOG1(FR)
      EG=ALOG1(G)
      CALL MOVEA(EFR,EG)
      CALL MREL(-4,-6)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>IF(INDEX.EQ.1) CALL AOPST(1,IP)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>IF(INDEX.EQ.2) CALL AOPST(1,IX)

C  PAGE 96

  120 CONTINUE
      IF(INDEX.EQ.2) GO TO 135
      DO 130 I=1,4
  130 A(I)=GPAR(I)
      GO TO 137
  135 DO 180 I=1,5
  180 A(I)=ETPAR(I)
  137 EFR=FRMIN
  140 FR=10.0**EFR
      IF(INDEX.EQ.1) EG=F1(FR,A)
      IF(INDEX.EQ.2) EG=F2(FR,A)
      IF(EFR.EQ.FRMIN) CALL MOVEA(EFR,EG)
      CALL DRAWA(EFR,EG)
      EFR=EFR+0.05
      IF(EFR.LE.FRMAX) GO TO 140
      IF(INDEX.EQ.1) GO TO 145
      CALL MABS(68,50)
      CALL DRABS(68,730)
  145 CONTINUE
      IF(INDEX.EQ.1) G=GMIN
      IF(INDEX.EQ.2) G=ETMIN
  150 CALL MOVEA(FRMIN,G)
      IF(INDEX.EQ.1) GO TO 155
      CALL MREL(-68,0)
      CALL DREL(-5,0)
  155 CALL MREL(-46,-5)
      CALL CHSIZ(2)
      CALL AOPST(2,ITEN)
      IEG=G
      CALL CODE
      WRITE(J,4000) IEG
      CALL MREL(1,11)
      CALL CHSIZ(3)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL AOPST(2,J)
      G=G+1.0
      IF(INDEX.EQ.1.AND.G.LE.GMAX) GO TO 150
      IF(INDEX.EQ.2.AND.G.LE.ETMAX) GO TO 150
      IF(INDEX.EQ.2) GO TO 170
      MULT=(FRMAX-FRMIN)/10.0+1.0
      FR=FRMIN
  160 CALL MOVEA(FR,GMIN)
      CALL MREL(-26,-25)
      CALL CHSIZ(2)
      CALL AOPST(2,ITEN)
      IEFR=FR
      CALL CODE
      WRITE(J,4000) IEFR
      CALL MREL(1,11)
      CALL CHSIZ(3)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL AOPST(2,J)
      FR=FR+MULT
      IF(FR.LE.FRMAX) GO TO 160
  170 INDEX=INDEX+1
      IF(INDEX.LE.2) GO TO 70
      CALL DWIND(FRMIN,FRMAX,FMIN,FMAX)

C  PAGE 97

      CALL TWIND(140,960,50,730)
      CALL CHSIZ(2)
      WIDT0=200.0
      IF(DELT0.LT.20.0) WIDT0=100.0
      T=TEMP0-WIDT0
      TMAX=TEMP0+WIDT0
  210 FR=ALPHT(T)
      EFR=ALOG1(FR)
      CALL MOVEA(EFR,FMIN)
      EFR=EFR+FMAX
      CALL DRAWA(EFR,FMAX)
      IF(EFR.GE.FRMAX) GO TO 220
      IT=T
      TEM=(T-TEMP0)/50.0
      ITEM=TEM
      IF(ITEM.NE.TEM) GO TO 220
      CALL CODE
C*****WRITE(II,5000) IT
      WRITE(IW,5000) IT 
      CALL MREL(-39,3)
      CALL AOPST(4,II)
  220 T=T+DELT0
      IF(T.LE.TMAX) GO TO 210
      F=FMIN
  230 CALL MOVEA(FRMAX,F)
      CALL MREL(2,-5)
      CALL CHSIZ(2)
      CALL AOPST(2,ITEN)
      IEF=F
      CALL CODE
      WRITE(J,4000) IEF
      CALL MREL(1,11)
      CALL CHSIZ(3)
C COMMENTED OUT AS THIS LINE FAILS TO COMPILE.
C====>CALL AOPST(2,J)
      F=F+1.0
      IF(F.LE.FMAX) GO TO 230
      CALL CHSIZ(2)
      CALL MABS(400,0)
      LABEL(1)=2HRE
      LABEL(2)=2HDU
      LABEL(3)=2HCE
      LABEL(4)=2HD 
      LABEL(5)=2HFR
      LABEL(6)=2HEQ
      LABEL(7)=2HUE
      LABEL(8)=2HNC
      LABEL(9)=2HY 
      LABEL(10)=2HFR
      LABEL(11)=2H H
      LABEL(12)=1HZ
      CALL AOPST(23,LABEL)
      CALL MABS(430,755)
      LABEL(1)=2HTE
      LABEL(2)=2HMP
      LABEL(3)=2HER
      LABEL(4)=2HAT

C  PAGE 98

      LABEL(5)=2HUR
      LABEL(6)=2HE 
      LABEL(7)=2HT 
      LABEL(8)=2HDE
      LABEL(9)=2HG.
      LABEL(10)=2H C
      CALL AOPST(20,LABEL)
      CALL MABS(5,530)
      LABEL(1)=1HL
      LABEL(2)=1H0
      LABEL(3)=1HS
      LABEL(4)=1HS
      LABEL(5)=1H 
      LABEL(6)=1HF
      LABEL(7)=1HA
      LABEL(8)=1HC
      LABEL(9)=1HT
      LABEL(10)=1H0
      LABEL(11)=1HR
      LABEL(12)=1H 
      LABEL(13)=1HE
      LABEL(14)=1HT
      LABEL(15)=1HA
      CALL VERTL(15,LABEL)
      CALL MABS(75,635)
      LABEL(1)=1HS
      LABEL(2)=1HH
      LABEL(3)=1HE
      LABEL(4)=1HA
      LABEL(5)=1HR
      LABEL(6)=1H 
      LABEL(7)=1HG
      LABEL(8)=1H 
      IF(IBUF(124).EQ.0) CALL VERTL(8,LABEL)
      LABEL(1)=1HY
      LABEL(2)=1H0
      LABEL(3)=1HU
      LABEL(4)=1HN
      LABEL(5)=1HG
      LABEL(6)=1HS
      LABEL(7)=1H 
      LABEL(8)=1HE
      LABEL(9)=1H 
      IF(IBUF(124).EQ.1) CALL VERTL(9,LABEL)
      LABEL(1)=1HM
      LABEL(2)=1H0
      LABEL(3)=1HD
      LABEL(4)=1HU
      LABEL(5)=1HL
      LABEL(6)=1HU
      LABEL(7)=1HS
      LABEL(8)=1H 
      LABEL(9)=1HN
      LABEL(10)=1H/
      LABEL(11)=1HM

C  PAGE 99

      LABEL(12)=1H*
      LABEL(13)=1H*
      LABEL(14)=1H2
      CALL VERTL(14,LABEL)
      CALL MABS(1008,520)
      LABEL(1)=1HF
      LABEL(2)=1HR
      LABEL(3)=1HE
      LABEL(4)=1HQ
      LABEL(5)=1HU
      LABEL(6)=1HE
      LABEL(7)=1HN
      LABEL(8)=1HC
      LABEL(9)=1HY
      LABEL(10)=1H 
      LABEL(11)=1HF
      LABEL(12)=1H 
      LABEL(13)=1HH
      LABEL(14)=1HZ
      CALL VERTL(14,LABEL)
      CALL MABS(0,0)
      CALL CHSIZ(3)
      CALL ANMOD
      PAUSE
      CALL ERAS
      CALL RESET
      CALL CHSIZ(3)
      CALL HOME
      CALL ANMOD
      RETURN
4000  FORMAT(I2)
5000  FORMAT(I4)
      END

C=======================================================================

      SUBROUTINE PLTPK(N UM)
      COMMON DUMMY(60),IR,IW,IBUF(128),NPTS,XIN(64,5),YD(64),
     &       COFT0(3),TEMP0,CHISQ,NPAR,DELTA(5),DELHI(5),
     &       MASK(5),GPAR(4),ETPAR(5),CNSTR(4)
      IF(NUM-2) 10,20,30
   10 CONTINUE
      WRITE(IW,1000)
      WRITE(IW,1500) TEMP0,(GPAR(I),I=1,4)
      RETURN
   20 CONTINUE
      WRITE(IW,2000)
      WRITE(IW,2500) TEMP0,(ETPAR(I),I=1,5)
      RETURN
   30 CONTINUE
      WRITE(IW,3000) IBUF(121),(IBUF(J),J=1,30)
      WRITE(IW,1000)
      WRITE(IW,1500) TEMP0,(GPAR(I),I=1,4)

C  PAGE 100

      WRITE(IW,2000)
      WRITE(IW,2500) TEMP0,(ETPAR(I),I=1,5)
      WRITE(IW,6000)
      PAUSE
      RETURN
 1000 FORMAT(2X,47HLOG(M)=LOG(ML)+(2LOG(MROM/ML))/(1+(FROM/FR)**N)
     & /4X,4HTO C,6X,4HFROM,8X,4HMROM,7X,1HN,9X,2HML,
     & /15X,2HA1,10X,2HA2,8X,2HA3,8X,2HA4)
 1500 FORMAT(2X,F8.1,1PE12.4,1PE12.4,0PF8.3,1PE12.4)
 2000 FORMAT(2X,23HA=LOG(FR)-LOG(FROL))/C,
     & /2X,59HLOG(ETA)=LOG(ETAFROL)+((SL+SH)A+(SL-SH)(1-SQRT(1+A**2)))C/
     &2,/4X,4HT0 C,2X,7HETAFROL,4X,2HSL,6X,2HSH,7X,4HFROL,7X,1HC,
     & /13X,2HB1,6X,2HB2,6X,2HB3,8X,2HB4,8X,2HB5)
 2500 FORMAT(2X,F8.1,F8.3,F8.3,F8.3,1PE12.4,0PF8.3)
 3000 FORMAT(//2X,15HMATERIAL CODE :,I3,/2X,10HMATERIAL :,30A2)
 6000 FORMAT(2X,38HLOG(FR)=LOG(F)-12(T-TO)/(525/1.8+T-TO)//)
      END

C  PAGE 101

C ADD STUBS FOR SUBROUTINES THAT ARE NOT AVAILABLE, SO THAT
C THE PROGRAM CAN BE COMPILED SUCCESSFULLY.

      SUBROUTINE ANMOD()
      END
      
      SUBROUTINE CODE()
      END
      
      SUBROUTINE ERAS()
      END
      
      SUBROUTINE HOME()
      END
      
      SUBROUTINE RESET()
      END
      
      SUBROUTINE MOVEA(A,B)
      END
      
      SUBROUTINE DREL(IA,IB)
      END
      
      SUBROUTINE PNTA(A,B)
      END
      
      SUBROUTINE MREL(IA,IB)
      END
      
      SUBROUTINE AOPST(IA,LABEL)
      DIMENSION LABEL(*)
      END

      SUBROUTINE DRAWA(A,B)
      END
      
      SUBROUTINE CHSIZ(IA)
      END
      
      SUBROUTINE MABS(IA,IB)
      END

      SUBROUTINE INITT(IA)
      END
      
      SUBROUTINE DRABS(IA,IB)
      END
      
      SUBROUTINE DWIND(TMIN,TMAX,ETMIN,ETMAX)
      END
      
      SUBROUTINE EXEC(ICR,ICON,IBUF,LIBUF,NAME,INS)
      DIMENSION IBUF(*),NAME(*)
      END
      
      SUBROUTINE TERM(IA,IB)
      END
      
      SUBROUTINE TWIND(IA,IB,IC,ID)
      END
      
      SUBROUTINE FINIT(IA,IB)
      END
